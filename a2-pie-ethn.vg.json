{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "width": 700,
    "height": 380,
    "config": {
        "background": "#ffffff"
    },
    "data": {
        "url": "https://raw.githubusercontent.com/Arrtish2702/FIT3179_A2/main/population_state_with_year.csv"
    },
    "params": [
        {
            "name": "stateSelection",
            "value": "All",
            "bind": {
                "input": "select",
                "options": [
                    "All",
                    "Johor",
                    "Kedah",
                    "Kelantan",
                    "Melaka",
                    "Negeri Sembilan",
                    "Pahang",
                    "Pulau Pinang",
                    "Perak",
                    "Perlis",
                    "Sabah",
                    "Sarawak",
                    "Selangor",
                    "Terengganu",
                    "Kuala Lumpur",
                    "Putrajaya",
                    "Labuan"
                ],
                "name": "Select State: "
            }
        },
        {
            "name": "yearSelection",
            "value": 2024,
            "bind": {
                "input": "range",
                "min": 1980,
                "max": 2024,
                "step": 1,
                "name": "Select Year: "
            }
        }
    ],
    "transform": [
        {
            "filter": "datum.sex == 'both'"
        },
        {
            "filter": "datum.age == 'overall'"
        },
        {
            "filter": "datum.ethnicity != 'overall' && datum.ethnicity != 'bumi' && datum.ethnicity != 'other'"
        },
        {
            "filter": "datum.year == yearSelection"
        },
        {
            "filter": "stateSelection === 'All' || datum.state == stateSelection"
        },
        {
            "calculate": "datum.ethnicity == 'chinese' ? 'Chinese' : datum.ethnicity == 'indian' ? 'Indian' : datum.ethnicity == 'bumi_malay' ? 'Bumiputera Malay' : datum.ethnicity == 'bumi_other' ? 'Bumiputera Other' : datum.ethnicity == 'other_citizen' ? 'Other Citizen' : 'Other Non-Citizen'",
            "as": "formatted_ethnicity"
        },
        {
            "joinaggregate": [
                {
                    "op": "sum",
                    "field": "population",
                    "as": "total_population"
                }
            ],
            "groupby": ["ethnicity", "sex", "age", "year"]
        }
    ],
    "mark": "arc",
    "encoding": {
        "theta": {
            "field": "total_population",
            "type": "quantitative",
            "title": "Population"
        },
        "color": {
            "field": "formatted_ethnicity",
            "type": "nominal",
            "title": "Ethnicity",
            "scale": {
                "domain": [
                    "Chinese",
                    "Indian",
                    "Bumiputera Malay",
                    "Bumiputera Other",
                    "Other Citizen",
                    "Other Non-Citizen"
                ],
                "range": [
                    "#80cdc1",            
                    "#0D324D",
                    "#20a5b5",
                    "#363020",
                    "#dfc27d",
                    "#01665e"
                ]
            },
            "legend": {
                "title": "Ethnicity",
                "values": [
                    "Chinese",
                    "Indian",
                    "Bumiputera Malay",
                    "Bumiputera Other",
                    "Other Citizen",
                    "Other Non-Citizen"
                ]
            }
        },
        "tooltip": [
            {"field": "state", "type": "nominal", "title": "State"},
            {"aggregate": "sum", "field": "population", "type": "quantitative", "title": "Population"},
            {
                "field": "formatted_ethnicity",
                "title": "Ethnicity"
            }
        ]
    }
}
